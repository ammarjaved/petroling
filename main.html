<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/x-icon" href="./assets/images/main-logo.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

        <title>AEROSYNERGY</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    
        <link rel="stylesheet" href="./assets/lib/images_slider/css-view/lightbox.css">
        <script src="./assets/lib/images_slider/js-view/lightbox-2.6.min.js"></script>
        <title>AEROSYNERGY</title>
    <style>
        .card {
            /* border: 1px solid; */

        }
        .card-header{
            font-weight: 700;
        }

        #map {
            height: 600px;
        }
        li{
            list-style-type: none;
            margin-bottom: 0.5rem;
            
        }
        details >label{
            display: contents !important;
        }
        ul{
            padding-left: 0.5rem;
        }
    </style>


</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-3">
        <div class="container-fluid">
            <img src="./assets/images/main-logo.png" height="50" alt="">
            <!-- <a class="navbar-brand" href="#" style="overflow: hidden;">AEROSYNERGY</a> -->


        </div>
    </nav>

    <h5 class="m-1">PEMERIKSAAN KEJANGGALAN PEPASANGAN TNB &
        SENGGARAAN BUKAN ELEKTRIK TALIAN ATAS DI SELANGOR UNTUK DISTRIBUTION NETWORK
        DIVISION, TNB</h5>

    <div class="row text-center m-2">

        <div class="col-md-4 p-1">

            <div class="card p-0 mb-3"  style="height: 90%;">
                <div class="card-header " >W1</div>
                <div class="card-body row">
    
    
    
                    <div class="col-md-12 " onclick="addRemoveBundary('KUALA LUMPUR PUSAT' , 3.14925905877391 , 101.754098819705)" style="cursor: pointer;">
    
                        <div class="  p-1" style="background-color:  skyblue !important;color:white">
                            <p style="font-weight: 600;">KL PUSAT</p>
    
                        </div>
    
                    </div>
                </div>
            </div>
    
    </div>
        <div class="col-md-4 p-1">
        <div class="card p-0 mb-3 ">
            <div class="card-header " >B1</div>
            <div class="card-body row">



                <div class="col-md-4 " onclick="addRemoveBundary('PETALING JAYA', 3.1128074178475 , 101.605270457169)" style="cursor: pointer;">

                    <div class="  p-1" style="background-color:  purple !important;color:white">
                        <p style="font-weight: 600;">PJ</p>

                    </div>

                </div>

                <div class="col-md-4 " onclick="addRemoveBundary('RAWANG' , 3.47839445121726, 101.622905486475)" style="cursor: pointer;">

                    <div class=" mx-1   p-1" style="background-color:  purple !important;color:white">
                        <p style="font-weight: 600;">RAWANG</p>

                    </div>

                </div>
                <div class="col-md-4 " onclick="addRemoveBundary('KUALA SELANGOR' , 3.40703209426401, 101.317426926947)" style="cursor: pointer;">

                    <div class="ml-0  p-1" style="background-color:  purple !important; color:white;">
                        <p style="font-weight: 600;">K.SELANGOR </p>

                    </div>

                </div>
            </div>
        </div>

    </div>
    <div class="col-md-4 p-1">
        <div class="card p-0 mb-3 ">
            <div class="card-header "  >B2</div>
            <div class="card-body row">



                <div class="col-md-6 " onclick="addRemoveBundary('KLANG' , 3.08428642705789, 101.436185279023)" style="cursor: pointer;color:white">

                    <div class=" p-1" style="background-color:  red !important;">
                        <p style="font-weight: 600;">KLANG</p>

                    </div>

                </div>

                <div class="col-md-6 " onclick="addRemoveBundary('PELABUHAN KLANG' , 2.98188527916042, 101.324234779569)" style="cursor: pointer;color:white">

                    <div class=" mx-1   p-1" style="background-color:  red !important;">
                        <p style="font-weight: 600;">PORT KLANG</p>

                    </div>

                </div>

            </div>
        </div>

</div>
<div class=" p-1">
        <div class="card p-0 mb-3">
            <div class="card-header "  >B4</div>
            <div class="card-body row">



                <div class="col-md-3 " onclick="addRemoveBundary('CHERAS' , 3.14197346621987, 101.849883983416)" style="cursor: pointer;color:white">

                    <div class=" p-1" style="background-color:  green !important; height: 100%;">
                        <p style="font-weight: 600;">CHERAS</p>

                    </div>

                </div>

                <div class="col-md-3 " onclick="addRemoveBundary('BANTING' , 2.82111390453244 , 101.505890775541)" style="cursor: pointer;">

                    <div class=" mx-1   p-1 text-capitalize" style="background-color:  green !important;color:white ; height: 100%;">
                        <p style="font-weight: 600;">BANTING/SEPANG</p>

                    </div>

                </div>

                <div class="col-md-3 " onclick="bangi()" style="cursor: pointer;">

                    <div class=" mx-1  p-1 text-capitalize" style="background-color:  green !important;color:white;  height: 100%;">
                        <p style="font-weight: 600;">BANGI</p>

                    </div>

                </div>

                <div class="col-md-3 " onclick="addRemoveBundary('PUTRAJAYA & CYBERJAYA' , 2.92875032271019 , 101.675338316575)" style="cursor: pointer;">

                    <div class=" mx-1   p-1 t" style="background-color:  green !important;color:white">
                        <p style="font-weight: 600;">PUTRAJAYA/CYBERJAYA/PUCHONG</p>

                    </div>

                </div>

            </div>
        </div>
</div>



    </div>



  <div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Site Data Info</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body " >
          <table class="table table-bordered">
            <tbody id="my_data"></tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
         
        </div>
      </div>
    </div>
  </div>
    <div class="row m-2">
        <div class="col-2 p-0">
            <div class="card p-0 m-0"
                style="border: 1px solid rgb(177, 175, 175) !important; border-radius: 0px !important; height: 100% !important;">
                <div class="card-header"><strong> NAVIGATION</strong></div>
                <div class="card-body">

                    <div class="col-md-12 mb-2" class="form-group">
                        <label >Select Info Layer :</label>
                        <select class="form-select" id="tableLayer" onchange="activeSelectedLayerOther(this.value)">
                          <option value="" hidden>Select Layer</option>
                            <option value="lv_fuse">lv_fuse</option>
                            <option value="lv_ug_conductor">lv_ug_conductor</option>
                            <option value="lvdb_fp">lvdb_fp</option>
                            <option value="street_light">street_light</option>
                            <option value="pole">pole</option>
                         
                        </select>
                    </div>
                    <details class="mb-3">
                        <summary><strong>Patrolling 3rd Party Digging Activities</strong> </summary>
                       <ul >
                        <li > <input type="checkbox" name="" id="petroling_a"> <label for="petroling_a">Pemeriksaan di Jalan</label> </li>
                        <li ><input type="checkbox" name="" id="petroling_b"> <label for="petroling_b">Mengeluarkan notis</label> </li>
                        <li><input type="checkbox" name="" id="petroling_c"> <label for="petroling_c">Menyelia kerja-kerja korekan</label> </li>
                        <li><input type="checkbox" name="" id="petroling_d"> <label for="petroling_d">Report</label> </li>
                       </ul>
                      </details>

                      <details class="mb-3">
                        <summary><strong>Pencawang</strong> </summary>
                       <ul >
                        <li > <input type="checkbox" name="" id="pencawang_a"> <label for="pencawang_a">Pemeriksaan visual dan pelaporan </label> </li>
                        <li ><input type="checkbox" name="" id="pencawang_b"> <label for="pencawang_b">Pembersihan iklan haram/banner </label> </li>
                        
                        <li ><input type="checkbox" name="" id="pencawang_c"> <label for="pencawang_c">Report</label> </li>
                         </ul>
                      </details>


                      <details class="mb-3">
                        <summary><strong>Feeder Pillar</strong> </summary>
                       <ul >
                        <li > <input type="checkbox" name="" id="feeder_a"> <label for="feeder_a">Pemeriksaan visual</label> </li>
                        <li ><input type="checkbox" name="" id="feeder_b"> <label for="feeder_b">Pembersihan iklan haram/banner</label> </li>
                        
                        <li ><input type="checkbox" name="" id="feeder_c"> <label for="feeder_c">Report</label> </li>
                         </ul>
                      </details>

                      <details class="mb-3">
                        <summary><strong> Tiang + Talian VT & VR</strong> </summary>
                       <ul >
                        <li > <input type="checkbox" name="" id="tiang_a"> <label for="tiang_a">Pendaftaran aset, pemeriksaan visual </label> </li>
                        <li ><input type="checkbox" name="" id="tiang_b"> <label for="tiang_b">Pembersihan iklan haram/banner</label> </li>
                        <li ><input type="checkbox" name="" id="tiang_c"> <label for="tiang_c">Pembersihan creepers</label> </li>
                        <li ><input type="checkbox" name="" id="tiang_d"> <label for="tiang_d">Report</label> </li>
                         </ul>
                      </details>


                      <details class="mb-3">
                        <summary><strong>  Link Box Pelbagai Voltan</strong> </summary>
                       <ul >
                        <li > <input type="checkbox" name="" id="tiang_a"> <label for="tiang_a"> Pemeriksaan visual</label> </li>
                        <li ><input type="checkbox" name="" id="tiang_b"> <label for="tiang_b"> Pembersihan iklan haram/banner</label> </li>
                        <li ><input type="checkbox" name="" id="tiang_c"> <label for="tiang_c">Pembersihan semak samun / creepers/sampah/ rumput</label> </li>
                        <li ><input type="checkbox" name="" id="tiang_d"> <label for="tiang_d">Report</label> </li>
                         </ul>
                      </details>


                      <details class="mb-3">
                        <summary><strong>  Cable bridge</strong> </summary>
                       <ul >
                        <li > <input type="checkbox" name="" id="cable_a"> <label for="cable_a"> Pemeriksaan visual</label> </li>
                        <li ><input type="checkbox" name="" id="cable_b"> <label for="cable_b"> Pembersihan semak samun / creepers/sampah/ rumput</label> </li>
                        <li ><input type="checkbox" name="" id="cable_c"> <label for="cable_c">Report</label> </li>
                         </ul>
                      </details>
                    
                 
                    <!-- <div id="my_data"></div> -->

                </div>
            </div>
        </div>
        <div class="col-10 p-0 ">
            <div class="card p-0 m-0"
                style="border: 1px solid rgb(177, 175, 175) !important; border-radius: 0px !important;">
                <div class="card-header text-center"><strong> MAP</strong></div>
                <div class="card-body p-0">
                    <div id="map">


                    </div>
                </div>
            </div>


        </div>
    </div>

    <script src="./assets/lib/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.js"></script>

    <script type="text/javascript">
        var baseLayers
        map = L.map('map').setView([3.016603, 101.858382], 5);
        // check =  document.getElementById('map').style.cursor = 'pointer'

        var st1 = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
        }).addTo(map);
        var street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');

        baseLayers = {
            "Satellite": st1,
            "Street": street
        };



        boundary = L.tileLayer.wms("http://121.121.232.54:7090/geoserver/cite/wms", {
            layers: 'cite:boundary_bangi_east',
            format: 'image/png',
            maxZoom: 21,
            transparent: true
        }, {
            buffer: 10
        });
       
        ugc = L.tileLayer.wms("http://121.121.232.54:7090/geoserver/cite/wms", {
            layers: 'cite:lv_ug_conductor',
            format: 'image/png',
            maxZoom: 21,
            transparent: true
        }, {
            buffer: 10
        });
        

        lvdb = L.tileLayer.wms("http://121.121.232.54:7090/geoserver/cite/wms", {
            layers: 'cite:lvdb_fp',
            format: 'image/png',
            maxZoom: 21,
            transparent: true
        }, {
            buffer: 10
        });
        

        manhole = L.tileLayer.wms("http://121.121.232.54:7090/geoserver/cite/wms", {
            layers: 'cite:manhole',
            format: 'image/png',
            maxZoom: 21,
            transparent: true
        }, {
            buffer: 10
        });
        manhole;

        street_light = L.tileLayer.wms("http://121.121.232.54:7090/geoserver/cite/wms", {
            layers: 'cite:street_light',
            format: 'image/png',
            maxZoom: 21,
            transparent: true
        }, {
            buffer: 10
        });
       
        pole = L.tileLayer.wms("http://121.121.232.54:7090/geoserver/cite/wms", {
            layers: 'cite:pole',
            format: 'image/png',
            maxZoom: 21,
            transparent: true
        }, {
            buffer: 10
        });
       

        lf = L.tileLayer.wms("http://121.121.232.54:7090/geoserver/cite/wms", {
            layers: 'cite:lv_fuse',
            format: 'image/png',
            maxZoom: 21,
            transparent: true
        }, {
            buffer: 10
        });
       

        groupedOverlays = {
            "POI": {
                "boundary_bangi_east": boundary,
                "lv fuse": lf,
                "lvdb_fp": lvdb,
                "lv_ug_conductor": ugc,
                "street_light": street_light,
                "pole": pole

            }
        };

        var layerControl = L.control.groupedLayers(baseLayers, groupedOverlays, {
            collapsed: true,
            position: 'topright'
            // groupCheckboxes: true
        }).addTo(map);
         var lc = document.getElementsByClassName('leaflet-control-layers')
         lc[0].style.display = "none";


        var bangi_status = false;
        var addTOmap = false;
        var boundary2 = '';

        boundary3 = L.tileLayer.wms("http://121.121.232.54:7090/geoserver/cite/wms", {
            layers: 'cite:aero_apks',
            format: 'image/png',
            maxZoom: 21,
            transparent: true
        }, {
            buffer: 10
        })
        map.addLayer(boundary3)
        map.setView([2.59340882301331, 101.07054901123], 8);

        function bangi() {
            map.removeLayer(boundary3)
            if (boundary2 !== '') {
                map.removeLayer(boundary2)
            }
            if (bangi_status == false) {

                map.addLayer(boundary);
                map.addLayer(lf);
                map.addLayer(lvdb);
                map.addLayer(ugc);
                map.addLayer(street_light);
                map.addLayer(pole);
                
               

                map.setView([3.016603, 101.858382], 11);
                bangi_status = true
                lc[0].style.display = 'block';

            } else {
                map.removeLayer(boundary);
                map.removeLayer(lf);
                map.removeLayer(lvdb);
                map.removeLayer(ugc);
                map.removeLayer(street_light);
                map.removeLayer(pole);
              
                map.setView([3.016603, 101.858382], 5);
                bangi_status = false
                lc[0].style.display = 'none';
            }
        }

        function activeSelectedLayerOther(val) {
         
            
            var sel_lyr = ''

            if (val == 'lv_fuse') { sel_lyr = lf ;}
            if (val == 'lv_ug_conductor') {sel_lyr = ugc ;}
            if (val == 'lvdb_fp') { sel_lyr = lvdb; }
            if (val == 'pole') { sel_lyr = pole; }
            if (val == 'manhole') { sel_lyr = manhole; }
            if (val == 'street_light') {sel_lyr = street_light;}

            map.off('click');
            map.on('click', function(e) {
                var url = getFeatureInfoUrl(
                    map,
                    sel_lyr,
                    e.latlng, {
                        'info_format': 'application/json',
                        'propertyName': 'NAME,AREA_CODE,DESCRIPTIO'
                    }
                );
                $.ajax({
                    url: 'services/proxy.php?url=' + encodeURIComponent(url),
                    dataType: 'JSON',
                    //data: data,
                    method: 'GET',
                    async: false,
                    success: function callback(data) {
                       console.log(data)
                        if (data.features.length != 0) {
                            var str = '';
                            for (key in data.features[0].properties) {
                                //console.log(key);
                                //console.log(data.features[0].properties[key]);
                                if (key == 'image_1' || key == 'image_2' || key == 'image_3' || key ==
                                    'image_4' || key == 'image_5' || key == 'image_6' || key ==
                                    'image_7' || key == 'image_8' || key == 'image_9' || key ==
                                    'image_10') {
                                    str = str + '<tr><td>' + key + '</td><td><a href="' + data.features[
                                            0].properties[key] +
                                        '" class=\'example-image-link\' data-lightbox=\'example-set\' title=\'&lt;button class=&quot;primary &quot; onclick= rotate_img(&quot;pic1&quot)  &gt;Rotate image&lt;/button&gt;\'><img src="' +
                                        data.features[0].properties[key] +
                                        '" width="20px" height="20px"></a></td></tr>'

                                } else {
                                    str = str + '<tr><td>' + key + '</td><td>' + data.features[0]
                                        .properties[key] + '</td></tr>'
                                }
                            }
                            $("#my_data").html(str);
                            $('#myModal').modal('show');
                            if (identifyme != '') {
                                map.removeLayer(identifyme)
                            }
                            var myStyle = {
                                "fillColor": "#ff7800"
                            };
                            identifyme = L.geoJSON(data.features[0].geometry, {
                                style: myStyle
                            }).addTo(map);

                        }

                    }
                });


            });
        }



        function getFeatureInfoUrl(map, layer, latlng, params) {

            var point = map.latLngToContainerPoint(latlng, map.getZoom()),
                size = map.getSize(),

                params = {
                    request: 'GetFeatureInfo',
                    service: 'WMS',
                    srs: 'EPSG:4326',
                    styles: layer.wmsParams.styles,
                    transparent: layer.wmsParams.transparent,
                    version: layer._wmsVersion,
                    format: layer.wmsParams.format,
                    bbox: map.getBounds().toBBoxString(),
                    height: size.y,
                    width: size.x,
                    layers: layer.wmsParams.layers,
                    query_layers: layer.wmsParams.layers,
                    info_format: 'application/json'
                };

            params[params.version === '1.3.0' ? 'i' : 'x'] = parseInt(point.x);
            params[params.version === '1.3.0' ? 'j' : 'y'] = parseInt(point.y);

            // return this._url + L.Util.getParamString(params, this._url, true);

            var url = layer._url + L.Util.getParamString(params, layer._url, true);
            if (typeof layer.wmsParams.proxy !== "undefined") {


                // check if proxyParamName is defined (instead, use default value)
                if (typeof layer.wmsParams.proxyParamName !== "undefined")
                    layer.wmsParams.proxyParamName = 'url';

                // build proxy (es: "proxy.php?url=" )
                _proxy = layer.wmsParams.proxy + '?' + layer.wmsParams.proxyParamName + '=';

                url = _proxy + encodeURIComponent(url);

            }

            return url.toString();

        }


       
        function addRemoveBundary(param , paramY, paramX) {
            map.removeLayer(boundary3)
            if (bangi_status == true) {
            bangi();
           }
            
            if (boundary2 !== '') {
                map.removeLayer(boundary2)
            }
                boundary2 = L.tileLayer.wms("http://121.121.232.54:7090/geoserver/cite/wms", {
            layers: 'cite:aero_apks',
            format: 'image/png',
            cql_filter: "station='"+param+"'",
            maxZoom: 21,
            transparent: true
        }, {
            buffer: 10
        })
        map.addLayer(boundary2)

        map.setView([parseFloat(paramY), parseFloat(paramX)], 11);

        
           
           

        }

 

    </script>
</body>

</html>
